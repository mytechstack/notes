<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cache Pre-hydration Architecture</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background: #f5f7fa;
        }
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        h1 {
            text-align: center;
            color: #2c3e50;
            margin-bottom: 40px;
        }
        .diagram-section {
            margin-bottom: 50px;
        }
        .section-title {
            font-size: 20px;
            font-weight: 600;
            color: #34495e;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #3498db;
        }
        svg {
            width: 100%;
            height: auto;
            border: 1px solid #e1e8ed;
            border-radius: 8px;
            background: #fafbfc;
        }
        .legend {
            display: flex;
            gap: 30px;
            flex-wrap: wrap;
            margin-top: 20px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
        }
        .legend-item {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .legend-box {
            width: 40px;
            height: 30px;
            border-radius: 4px;
            border: 2px solid #333;
        }
        .legend-text {
            font-size: 14px;
            color: #2c3e50;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Cache Pre-hydration Architecture & Flow</h1>
        
        <!-- Architecture Diagram -->
        <div class="diagram-section">
            <div class="section-title">1. System Architecture & Boundaries</div>
            <svg viewBox="0 0 1400 800" xmlns="http://www.w3.org/2000/svg">
                <!-- Pre-hydrator Boundary Box -->
                <rect x="270" y="40" width="480" height="480" fill="#e8f4f8" stroke="#3498db" stroke-width="3" rx="12" stroke-dasharray="10,5"/>
                <text x="510" y="70" text-anchor="middle" fill="#3498db" font-size="18" font-weight="bold">CACHE PRE-HYDRATOR SERVICE BOUNDARY</text>
                
                <!-- User/Client Layer -->
                <rect x="50" y="120" width="150" height="80" fill="#3498db" stroke="#2c3e50" stroke-width="2" rx="8"/>
                <text x="125" y="155" text-anchor="middle" fill="white" font-size="16" font-weight="bold">User Browser</text>
                <text x="125" y="175" text-anchor="middle" fill="white" font-size="12">+ Encoded Cookie</text>
                
                <!-- Platform Layer -->
                <rect x="50" y="260" width="150" height="80" fill="#9b59b6" stroke="#2c3e50" stroke-width="2" rx="8"/>
                <text x="125" y="295" text-anchor="middle" fill="white" font-size="16" font-weight="bold">Your Platform</text>
                <text x="125" y="315" text-anchor="middle" fill="white" font-size="12">Login Handler</text>
                
                <!-- Cache Pre-hydrator Components -->
                <g id="prehydrator-components">
                    <!-- Cookie Decoder -->
                    <rect x="300" y="100" width="160" height="70" fill="#16a085" stroke="#2c3e50" stroke-width="2" rx="8"/>
                    <text x="380" y="125" text-anchor="middle" fill="white" font-size="13" font-weight="bold">Cookie Decoder</text>
                    <text x="380" y="145" text-anchor="middle" fill="white" font-size="11">Extracts user ID</text>
                    <text x="380" y="160" text-anchor="middle" fill="white" font-size="11">& session token</text>
                    
                    <!-- Access Pattern Analyzer -->
                    <rect x="300" y="200" width="160" height="70" fill="#16a085" stroke="#2c3e50" stroke-width="2" rx="8"/>
                    <text x="380" y="225" text-anchor="middle" fill="white" font-size="13" font-weight="bold">Pattern Analyzer</text>
                    <text x="380" y="245" text-anchor="middle" fill="white" font-size="11">Reads history</text>
                    <text x="380" y="260" text-anchor="middle" fill="white" font-size="11">from Redis</text>
                    
                    <!-- Service Orchestrator -->
                    <rect x="300" y="300" width="160" height="80" fill="#16a085" stroke="#2c3e50" stroke-width="2" rx="8"/>
                    <text x="380" y="330" text-anchor="middle" fill="white" font-size="13" font-weight="bold">Service</text>
                    <text x="380" y="348" text-anchor="middle" fill="white" font-size="13" font-weight="bold">Orchestrator</text>
                    <text x="380" y="368" text-anchor="middle" fill="white" font-size="10">Parallel calls to</text>
                    <text x="380" y="380" text-anchor="middle" fill="white" font-size="10">backend services</text>
                    
                    <!-- Cache Writer -->
                    <rect x="300" y="410" width="160" height="70" fill="#16a085" stroke="#2c3e50" stroke-width="2" rx="8"/>
                    <text x="380" y="440" text-anchor="middle" fill="white" font-size="13" font-weight="bold">Cache Writer</text>
                    <text x="380" y="460" text-anchor="middle" fill="white" font-size="11">Writes to Redis</text>
                    <text x="380" y="475" text-anchor="middle" fill="white" font-size="11">with TTL</text>
                </g>
                
                <!-- Redis Cache -->
                <rect x="520" y="200" width="200" height="100" fill="#c0392b" stroke="#2c3e50" stroke-width="2" rx="8"/>
                <text x="620" y="235" text-anchor="middle" fill="white" font-size="16" font-weight="bold">Redis Cache</text>
                <text x="620" y="255" text-anchor="middle" fill="white" font-size="12">Shared Storage</text>
                <text x="620" y="275" text-anchor="middle" fill="white" font-size="11">‚Ä¢ User data cache</text>
                <text x="620" y="290" text-anchor="middle" fill="white" font-size="11">‚Ä¢ Access patterns</text>
                
                <!-- Session Tracker (Post-Auth) -->
                <rect x="50" y="430" width="150" height="80" fill="#e67e22" stroke="#2c3e50" stroke-width="2" rx="8"/>
                <text x="125" y="460" text-anchor="middle" fill="white" font-size="14" font-weight="bold">Session</text>
                <text x="125" y="480" text-anchor="middle" fill="white" font-size="14" font-weight="bold">Tracker</text>
                <text x="125" y="498" text-anchor="middle" fill="white" font-size="10">(Post-auth only)</text>
                
                <!-- Backend Services -->
                <g id="services">
                    <!-- Profile Service -->
                    <rect x="820" y="60" width="140" height="65" fill="#27ae60" stroke="#2c3e50" stroke-width="2" rx="8"/>
                    <text x="890" y="88" text-anchor="middle" fill="white" font-size="13" font-weight="bold">Profile</text>
                    <text x="890" y="108" text-anchor="middle" fill="white" font-size="13" font-weight="bold">Service</text>
                    
                    <!-- Preferences Service -->
                    <rect x="820" y="145" width="140" height="65" fill="#27ae60" stroke="#2c3e50" stroke-width="2" rx="8"/>
                    <text x="890" y="173" text-anchor="middle" fill="white" font-size="13" font-weight="bold">Preferences</text>
                    <text x="890" y="193" text-anchor="middle" fill="white" font-size="13" font-weight="bold">Service</text>
                    
                    <!-- Auth Service -->
                    <rect x="820" y="230" width="140" height="65" fill="#27ae60" stroke="#2c3e50" stroke-width="2" rx="8"/>
                    <text x="890" y="258" text-anchor="middle" fill="white" font-size="13" font-weight="bold">Permissions</text>
                    <text x="890" y="278" text-anchor="middle" fill="white" font-size="13" font-weight="bold">Service</text>
                    
                    <!-- Resource Service -->
                    <rect x="820" y="315" width="140" height="65" fill="#27ae60" stroke="#2c3e50" stroke-width="2" rx="8"/>
                    <text x="890" y="343" text-anchor="middle" fill="white" font-size="13" font-weight="bold">Resource</text>
                    <text x="890" y="363" text-anchor="middle" fill="white" font-size="13" font-weight="bold">Service</text>
                    
                    <!-- More Services -->
                    <rect x="820" y="400" width="140" height="65" fill="#27ae60" stroke="#2c3e50" stroke-width="2" rx="8"/>
                    <text x="890" y="428" text-anchor="middle" fill="white" font-size="13" font-weight="bold">Other</text>
                    <text x="890" y="448" text-anchor="middle" fill="white" font-size="13" font-weight="bold">Services...</text>
                </g>
                
                <!-- Application Teams Box -->
                <rect x="1030" y="540" width="330" height="220" fill="#f8f9fa" stroke="#34495e" stroke-width="3" rx="12"/>
                <text x="1195" y="570" text-anchor="middle" fill="#34495e" font-size="18" font-weight="bold">APPLICATION TEAMS APPS</text>
                
                <!-- Backend Service Layer (within apps) -->
                <rect x="1060" y="595" width="130" height="70" fill="#7f8c8d" stroke="#2c3e50" stroke-width="2" rx="6"/>
                <text x="1125" y="620" text-anchor="middle" fill="white" font-size="12" font-weight="bold">Backend</text>
                <text x="1125" y="638" text-anchor="middle" fill="white" font-size="12" font-weight="bold">Service Layer</text>
                <text x="1125" y="655" text-anchor="middle" fill="white" font-size="10">(Team's code)</text>
                
                <!-- Frontend (within apps) -->
                <rect x="1210" y="595" width="130" height="70" fill="#7f8c8d" stroke="#2c3e50" stroke-width="2" rx="6"/>
                <text x="1275" y="620" text-anchor="middle" fill="white" font-size="12" font-weight="bold">Frontend</text>
                <text x="1275" y="638" text-anchor="middle" fill="white" font-size="12" font-weight="bold">Application</text>
                <text x="1275" y="655" text-anchor="middle" fill="white" font-size="10">(Team's UI)</text>
                
                <text x="1195" y="690" text-anchor="middle" fill="#7f8c8d" font-size="11" font-style="italic">Apps running on your platform</text>
                <text x="1195" y="710" text-anchor="middle" fill="#7f8c8d" font-size="11" font-style="italic">Their service layer reads from Redis</text>
                <text x="1195" y="728" text-anchor="middle" fill="#7f8c8d" font-size="11" font-style="italic">directly (bypassing backend services)</text>
                
                <!-- Arrows -->
                <!-- User to Platform (with cookie) -->
                <path d="M 125 200 L 125 260" stroke="#2c3e50" stroke-width="2" fill="none" marker-end="url(#arrowhead)"/>
                <rect x="132" y="220" width="80" height="25" fill="#fff9e6" stroke="#f39c12" stroke-width="1" rx="3"/>
                <text x="172" y="237" text-anchor="middle" font-size="10" fill="#2c3e50">Cookie with</text>
                <text x="172" y="248" text-anchor="middle" font-size="10" fill="#2c3e50">user context</text>
                
                <!-- Platform to Pre-hydrator -->
                <path d="M 200 300 L 300 135" stroke="#e74c3c" stroke-width="2" fill="none" marker-end="url(#arrowhead-red)"/>
                <text x="220" y="210" font-size="11" fill="#e74c3c" font-weight="bold">1. Trigger with</text>
                <text x="220" y="223" font-size="11" fill="#e74c3c" font-weight="bold">encoded cookie</text>
                
                <!-- Cookie decoder to Pattern Analyzer -->
                <path d="M 380 170 L 380 200" stroke="#2c3e50" stroke-width="2" fill="none" marker-end="url(#arrowhead)"/>
                
                <!-- Pattern Analyzer to Redis (read patterns) -->
                <path d="M 460 235 L 520 235" stroke="#3498db" stroke-width="2" fill="none" marker-end="url(#arrowhead-blue)" stroke-dasharray="3,3"/>
                <text x="490" y="230" text-anchor="middle" font-size="9" fill="#3498db">Read patterns</text>
                
                <!-- Pattern Analyzer to Orchestrator -->
                <path d="M 380 270 L 380 300" stroke="#2c3e50" stroke-width="2" fill="none" marker-end="url(#arrowhead)"/>
                
                <!-- Orchestrator to Services (parallel) -->
                <path d="M 460 330 L 820 92" stroke="#e74c3c" stroke-width="3" fill="none" marker-end="url(#arrowhead-red)"/>
                <path d="M 460 340 L 820 177" stroke="#e74c3c" stroke-width="3" fill="none" marker-end="url(#arrowhead-red)"/>
                <path d="M 460 350 L 820 262" stroke="#e74c3c" stroke-width="3" fill="none" marker-end="url(#arrowhead-red)"/>
                <path d="M 460 360 L 820 347" stroke="#e74c3c" stroke-width="3" fill="none" marker-end="url(#arrowhead-red)"/>
                <path d="M 460 370 L 820 432" stroke="#e74c3c" stroke-width="3" fill="none" marker-end="url(#arrowhead-red)"/>
                <text x="640" y="240" font-size="12" fill="#e74c3c" font-weight="bold">2. Parallel calls</text>
                <text x="640" y="255" font-size="12" fill="#e74c3c" font-weight="bold">with session token</text>
                
                <!-- Orchestrator to Cache Writer -->
                <path d="M 380 380 L 380 410" stroke="#2c3e50" stroke-width="2" fill="none" marker-end="url(#arrowhead)"/>
                <text x="395" y="398" font-size="9" fill="#2c3e50">Responses</text>
                
                <!-- Cache Writer to Redis -->
                <path d="M 460 445 L 520 250" stroke="#2c3e50" stroke-width="2" fill="none" marker-end="url(#arrowhead)"/>
                <text x="490" y="340" font-size="11" fill="#2c3e50">3. Write cache</text>
                
                <!-- Platform to Session Tracker (post-auth) -->
                <path d="M 125 340 L 125 430" stroke="#95a5a6" stroke-width="2" fill="none" marker-end="url(#arrowhead-gray)"/>
                <text x="140" y="390" font-size="10" fill="#95a5a6">After auth:</text>
                <text x="140" y="403" font-size="10" fill="#95a5a6">Track access</text>
                
                <!-- Session Tracker to Redis -->
                <path d="M 200 470 L 520 250" stroke="#95a5a6" stroke-width="2" fill="none" marker-end="url(#arrowhead-gray)" stroke-dasharray="3,3"/>
                <text x="340" y="360" font-size="9" fill="#95a5a6">Store patterns</text>
                
                <!-- Apps Backend to Redis (DIRECT READ) -->
                <path d="M 1060 630 L 720 250" stroke="#27ae60" stroke-width="3" fill="none" marker-end="url(#arrowhead-green)"/>
                <text x="880" y="440" font-size="13" fill="#27ae60" font-weight="bold">4. Apps read DIRECTLY</text>
                <text x="880" y="457" font-size="13" fill="#27ae60" font-weight="bold">from Redis (cache hit!)</text>
                <text x="880" y="475" font-size="11" fill="#27ae60">NO backend service calls needed</text>
                
                <!-- Apps Frontend to Backend Service Layer -->
                <path d="M 1210 630 L 1190 630" stroke="#34495e" stroke-width="2" fill="none" marker-end="url(#arrowhead-dark)"/>
                <text x="1200" y="620" font-size="9" fill="#34495e">API call</text>
                
                <!-- Arrow markers -->
                <defs>
                    <marker id="arrowhead" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
                        <polygon points="0 0, 10 3, 0 6" fill="#2c3e50"/>
                    </marker>
                    <marker id="arrowhead-red" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
                        <polygon points="0 0, 10 3, 0 6" fill="#e74c3c"/>
                    </marker>
                    <marker id="arrowhead-green" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
                        <polygon points="0 0, 10 3, 0 6" fill="#27ae60"/>
                    </marker>
                </defs>
                
                <!-- Labels for async -->
                <text x="490" y="340" font-size="11" fill="#7f8c8d" font-style="italic">Async/Non-blocking</text>
            </svg>
        </div>
        
        <!-- Sequence Diagram -->
        <div class="diagram-section">
            <div class="section-title">2. Detailed Sequence Flow (Cookie-Based Pre-hydration)</div>
            <svg viewBox="0 0 1400 1050" xmlns="http://www.w3.org/2000/svg">
                <!-- Timeline Headers -->
                <rect x="50" y="20" width="120" height="50" fill="#3498db" stroke="#2c3e50" stroke-width="2" rx="6"/>
                <text x="110" y="50" text-anchor="middle" fill="white" font-size="13" font-weight="bold">User</text>
                
                <rect x="230" y="20" width="120" height="50" fill="#9b59b6" stroke="#2c3e50" stroke-width="2" rx="6"/>
                <text x="290" y="50" text-anchor="middle" fill="white" font-size="13" font-weight="bold">Platform</text>
                
                <rect x="410" y="20" width="150" height="50" fill="#16a085" stroke="#2c3e50" stroke-width="2" rx="6"/>
                <text x="485" y="45" text-anchor="middle" fill="white" font-size="12" font-weight="bold">Cache Pre-</text>
                <text x="485" y="60" text-anchor="middle" fill="white" font-size="12" font-weight="bold">hydrator Service</text>
                
                <rect x="620" y="20" width="120" height="50" fill="#c0392b" stroke="#2c3e50" stroke-width="2" rx="6"/>
                <text x="680" y="50" text-anchor="middle" fill="white" font-size="13" font-weight="bold">Redis</text>
                
                <rect x="800" y="20" width="140" height="50" fill="#27ae60" stroke="#2c3e50" stroke-width="2" rx="6"/>
                <text x="870" y="45" text-anchor="middle" fill="white" font-size="12" font-weight="bold">Backend</text>
                <text x="870" y="60" text-anchor="middle" fill="white" font-size="12" font-weight="bold">Services</text>
                
                <rect x="1000" y="20" width="160" height="50" fill="#7f8c8d" stroke="#2c3e50" stroke-width="2" rx="6"/>
                <text x="1080" y="45" text-anchor="middle" fill="white" font-size="12" font-weight="bold">App Team's</text>
                <text x="1080" y="60" text-anchor="middle" fill="white" font-size="12" font-weight="bold">Service Layer</text>
                
                <rect x="1220" y="20" width="120" height="50" fill="#e67e22" stroke="#2c3e50" stroke-width="2" rx="6"/>
                <text x="1280" y="45" text-anchor="middle" fill="white" font-size="11" font-weight="bold">Session</text>
                <text x="1280" y="60" text-anchor="middle" fill="white" font-size="11" font-weight="bold">Tracker</text>
                
                <!-- Lifelines -->
                <line x1="110" y1="70" x2="110" y2="1000" stroke="#bdc3c7" stroke-width="2" stroke-dasharray="5,5"/>
                <line x1="290" y1="70" x2="290" y2="1000" stroke="#bdc3c7" stroke-width="2" stroke-dasharray="5,5"/>
                <line x1="485" y1="70" x2="485" y2="1000" stroke="#bdc3c7" stroke-width="2" stroke-dasharray="5,5"/>
                <line x1="680" y1="70" x2="680" y2="1000" stroke="#bdc3c7" stroke-width="2" stroke-dasharray="5,5"/>
                <line x1="870" y1="70" x2="870" y2="1000" stroke="#bdc3c7" stroke-width="2" stroke-dasharray="5,5"/>
                <line x1="1080" y1="70" x2="1080" y2="1000" stroke="#bdc3c7" stroke-width="2" stroke-dasharray="5,5"/>
                <line x1="1280" y1="70" x2="1280" y2="1000" stroke="#bdc3c7" stroke-width="2" stroke-dasharray="5,5"/>
                
                <!-- Sequence steps -->
                <!-- Step 1 -->
                <path d="M 110 100 L 290 100" stroke="#2c3e50" stroke-width="2" marker-end="url(#arrowhead)"/>
                <text x="200" y="95" text-anchor="middle" font-size="12" fill="#2c3e50">Lands on login page</text>
                <rect x="120" y="105" width="160" height="20" fill="#fff9e6" stroke="#f39c12" stroke-width="1" rx="3"/>
                <text x="200" y="118" text-anchor="middle" font-size="10" fill="#2c3e50">Cookie: user_context=encoded_data</text>
                
                <!-- Step 2 -->
                <path d="M 290 150 L 485 150" stroke="#e74c3c" stroke-width="2" marker-end="url(#arrowhead-red)"/>
                <text x="387" y="145" text-anchor="middle" font-size="12" fill="#e74c3c" font-weight="bold">Trigger pre-hydration</text>
                <rect x="300" y="155" width="175" height="30" fill="#ffe6e6" stroke="#e74c3c" stroke-width="1" rx="3"/>
                <text x="387" y="168" text-anchor="middle" font-size="10" fill="#2c3e50">Passes encoded cookie</text>
                <text x="387" y="180" text-anchor="middle" font-size="10" fill="#2c3e50">(async, non-blocking)</text>
                
                <!-- Step 3 - User continues -->
                <path d="M 290 210 L 110 210" stroke="#27ae60" stroke-width="2" marker-end="url(#arrowhead-green)" stroke-dasharray="3,3"/>
                <text x="200" y="205" text-anchor="middle" font-size="12" fill="#27ae60">Show login form</text>
                <text x="200" y="220" text-anchor="middle" font-size="10" fill="#7f8c8d">(doesn't wait for cache)</text>
                
                <!-- Background process box -->
                <rect x="400" y="250" width="550" height="480" fill="#ecf0f1" stroke="#95a5a6" stroke-width="2" rx="8" stroke-dasharray="5,5"/>
                <text x="675" y="275" text-anchor="middle" font-size="14" fill="#34495e" font-weight="bold">Pre-hydrator Service Internal Processing</text>
                
                <!-- Step 4 - Decode cookie -->
                <rect x="455" y="295" width="60" height="40" fill="#16a085" stroke="#2c3e50" stroke-width="2" rx="4"/>
                <text x="485" y="320" text-anchor="middle" font-size="10" fill="white" font-weight="bold">Decode</text>
                <text x="580" y="310" font-size="11" fill="#34495e">Extract: user_id, session_token</text>
                
                <!-- Step 5 - Read patterns from Redis -->
                <path d="M 485 350 L 680 350" stroke="#3498db" stroke-width="2" marker-end="url(#arrowhead-blue)"/>
                <text x="582" y="345" text-anchor="middle" font-size="11" fill="#3498db">Read access patterns</text>
                
                <path d="M 680 380 L 485 380" stroke="#3498db" stroke-width="2" marker-end="url(#arrowhead-blue)"/>
                <rect x="510" y="360" width="155" height="35" fill="#e3f2fd" stroke="#3498db" stroke-width="1" rx="3"/>
                <text x="587" y="375" text-anchor="middle" font-size="10" fill="#2c3e50">user:access_pattern:123</text>
                <text x="587" y="388" text-anchor="middle" font-size="10" fill="#2c3e50">[resource1, resource2...]</text>
                
                <!-- Step 6 - Build call list -->
                <rect x="455" y="410" width="60" height="40" fill="#16a085" stroke="#2c3e50" stroke-width="2" rx="4"/>
                <text x="485" y="435" text-anchor="middle" font-size="9" fill="white" font-weight="bold">Build call</text>
                <text x="580" y="425" font-size="11" fill="#34495e">Determine services to call</text>
                
                <!-- Step 7 - Parallel service calls -->
                <path d="M 485 470 L 870 470" stroke="#e74c3c" stroke-width="2" marker-end="url(#arrowhead-red)"/>
                <text x="677" y="465" text-anchor="middle" font-size="10" fill="#e74c3c">GET /profile (with token)</text>
                
                <path d="M 485 495 L 870 495" stroke="#e74c3c" stroke-width="2" marker-end="url(#arrowhead-red)"/>
                <text x="677" y="490" text-anchor="middle" font-size="10" fill="#e74c3c">GET /preferences (with token)</text>
                
                <path d="M 485 520 L 870 520" stroke="#e74c3c" stroke-width="2" marker-end="url(#arrowhead-red)"/>
                <text x="677" y="515" text-anchor="middle" font-size="10" fill="#e74c3c">GET /permissions (with token)</text>
                
                <path d="M 485 545 L 870 545" stroke="#e74c3c" stroke-width="2" marker-end="url(#arrowhead-red)"/>
                <text x="677" y="540" text-anchor="middle" font-size="10" fill="#e74c3c">GET /resources (with token)</text>
                
                <text x="677" y="565" text-anchor="middle" font-size="12" fill="#e74c3c" font-weight="bold">All in parallel ‚ö°</text>
                
                <!-- Step 8 - Responses -->
                <path d="M 870 590 L 485 590" stroke="#27ae60" stroke-width="2" marker-end="url(#arrowhead-green)"/>
                <text x="677" y="585" text-anchor="middle" font-size="10" fill="#27ae60">Response: profile, preferences, etc.</text>
                
                <!-- Step 9 - Write to cache -->
                <path d="M 485 625 L 680 625" stroke="#2c3e50" stroke-width="2" marker-end="url(#arrowhead)"/>
                <text x="582" y="620" text-anchor="middle" font-size="10" fill="#2c3e50">SET user:profile:123</text>
                
                <path d="M 485 650 L 680 650" stroke="#2c3e50" stroke-width="2" marker-end="url(#arrowhead)"/>
                <text x="582" y="645" text-anchor="middle" font-size="10" fill="#2c3e50">SET user:preferences:123</text>
                
                <path d="M 485 675 L 680 675" stroke="#2c3e50" stroke-width="2" marker-end="url(#arrowhead)"/>
                <text x="582" y="670" text-anchor="middle" font-size="10" fill="#2c3e50">SET user:permissions:123</text>
                
                <text x="582" y="695" text-anchor="middle" font-size="11" fill="#27ae60" font-weight="bold">‚úì Cache populated!</text>
                
                <path d="M 680 710 L 485 710" stroke="#27ae60" stroke-width="2" marker-end="url(#arrowhead-green)"/>
                <text x="582" y="705" text-anchor="middle" font-size="10" fill="#27ae60">OK</text>
                
                <!-- Step 10 - User submits login -->
                <path d="M 110 780 L 290 780" stroke="#2c3e50" stroke-width="2" marker-end="url(#arrowhead)"/>
                <text x="200" y="775" text-anchor="middle" font-size="12" fill="#2c3e50">Submit credentials</text>
                
                <!-- Step 11 - Platform authenticates -->
                <rect x="260" y="800" width="60" height="40" fill="#9b59b6" stroke="#2c3e50" stroke-width="2" rx="4"/>
                <text x="290" y="825" text-anchor="middle" font-size="10" fill="white" font-weight="bold">Auth OK</text>
                
                <!-- Step 12 - Platform redirects to app -->
                <path d="M 290 860 L 1080 860" stroke="#2c3e50" stroke-width="2" marker-end="url(#arrowhead)"/>
                <text x="685" y="855" text-anchor="middle" font-size="12" fill="#2c3e50">Redirect to app</text>
                
                <!-- Step 13 - App service layer checks cache FIRST -->
                <path d="M 1080 895 L 680 895" stroke="#f39c12" stroke-width="3" marker-end="url(#arrowhead-orange)"/>
                <text x="880" y="890" text-anchor="middle" font-size="12" fill="#f39c12" font-weight="bold">GET user:profile:123</text>
                <text x="880" y="908" text-anchor="middle" font-size="10" fill="#7f8c8d">(App checks cache FIRST)</text>
                
                <!-- Step 14 - Cache hit! -->
                <path d="M 680 930 L 1080 930" stroke="#27ae60" stroke-width="3" marker-end="url(#arrowhead-green)"/>
                <text x="880" y="925" text-anchor="middle" font-size="13" fill="#27ae60" font-weight="bold">CACHE HIT! ‚ö° Return data instantly</text>
                <rect x="750" y="935" width="260" height="25" fill="#e8f5e9" stroke="#27ae60" stroke-width="1" rx="3"/>
                <text x="880" y="951" text-anchor="middle" font-size="11" fill="#27ae60">~5ms response (vs ~500ms service call)</text>
                
                <!-- Step 15 - App responds to user -->
                <path d="M 1080 975 L 110 975" stroke="#27ae60" stroke-width="2" marker-end="url(#arrowhead-green)"/>
                <text x="595" y="970" text-anchor="middle" font-size="13" fill="#27ae60" font-weight="bold">App loads instantly with all data!</text>
                
                <!-- Step 16 - Post-login tracking -->
                <path d="M 290 1010 L 1280 1010" stroke="#95a5a6" stroke-width="1" marker-end="url(#arrowhead-gray)" stroke-dasharray="3,3"/>
                <text x="785" y="1005" text-anchor="middle" font-size="10" fill="#95a5a6">After login: Track user activity for future patterns</text>
                
                <!-- Timeline markers -->
                <text x="20" y="100" font-size="11" fill="#7f8c8d">t0</text>
                <text x="20" y="210" font-size="11" fill="#7f8c8d">t1</text>
                <text x="20" y="780" font-size="11" fill="#7f8c8d">t2</text>
                <text x="20" y="930" font-size="11" fill="#7f8c8d">t3</text>
                
                <!-- Arrow markers -->
                <defs>
                    <marker id="arrowhead-orange" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
                        <polygon points="0 0, 10 3, 0 6" fill="#f39c12"/>
                    </marker>
                    <marker id="arrowhead-blue" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
                        <polygon points="0 0, 10 3, 0 6" fill="#3498db"/>
                    </marker>
                    <marker id="arrowhead-gray" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
                        <polygon points="0 0, 10 3, 0 6" fill="#95a5a6"/>
                    </marker>
                    <marker id="arrowhead-dark" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
                        <polygon points="0 0, 10 3, 0 6" fill="#34495e"/>
                    </marker>
                </defs>
            </svg>
        </div>
        
        <!-- Legend -->
        <div class="legend">
            <div class="legend-item">
                <div class="legend-box" style="background: #3498db;"></div>
                <span class="legend-text">User/Client</span>
            </div>
            <div class="legend-item">
                <div class="legend-box" style="background: #9b59b6;"></div>
                <span class="legend-text">Your Platform</span>
            </div>
            <div class="legend-item">
                <div class="legend-box" style="background: #e67e22;"></div>
                <span class="legend-text">Session Tracker</span>
            </div>
            <div class="legend-item">
                <div class="legend-box" style="background: #16a085;"></div>
                <span class="legend-text">Cache Pre-hydrator</span>
            </div>
            <div class="legend-item">
                <div class="legend-box" style="background: #27ae60;"></div>
                <span class="legend-text">Backend Services</span>
            </div>
            <div class="legend-item">
                <div class="legend-box" style="background: #c0392b;"></div>
                <span class="legend-text">Redis Cache</span>
            </div>
            <div class="legend-item">
                <div class="legend-box" style="background: #34495e;"></div>
                <span class="legend-text">Application Teams</span>
            </div>
        </div>
        
        <!-- Key Benefits -->
        <div style="margin-top: 40px; padding: 25px; background: #e8f5e9; border-left: 5px solid #27ae60; border-radius: 8px;">
            <h3 style="margin-top: 0; color: #27ae60;">Key Benefits</h3>
            <ul style="line-height: 1.8; color: #2c3e50;">
                <li><strong>Performance:</strong> Cache is ready before user completes login - sub-100ms response times</li>
                <li><strong>User Experience:</strong> Application loads instantly after authentication</li>
                <li><strong>Reduced Load:</strong> Fewer calls to backend services during peak login times</li>
                <li><strong>Scalability:</strong> Async processing doesn't block the login flow</li>
                <li><strong>Smart Caching:</strong> Uses historical patterns to pre-load most relevant data</li>
            </ul>
        </div>
        
        <!-- Cache Pre-hydrator Responsibility Boundary -->
        <div style="margin-top: 40px; padding: 25px; background: #e3f2fd; border-left: 5px solid #2196f3; border-radius: 8px;">
            <h3 style="margin-top: 0; color: #1976d2;">Cache Pre-hydrator Service: Roles & Boundaries</h3>
            
            <h4 style="color: #1976d2; margin-top: 20px;">‚úÖ What the Pre-hydrator IS Responsible For:</h4>
            <ul style="line-height: 1.8; color: #2c3e50;">
                <li><strong>Cookie Decoding:</strong> Extract user ID and session token from encoded cookie</li>
                <li><strong>Pattern Analysis:</strong> Read user's historical access patterns from Redis</li>
                <li><strong>Service Orchestration:</strong> Make parallel calls to multiple backend services using the session token</li>
                <li><strong>Cache Population:</strong> Write responses to Redis with appropriate keys and TTLs</li>
                <li><strong>Error Handling:</strong> Gracefully handle service failures without impacting login flow</li>
                <li><strong>Performance Monitoring:</strong> Track cache hit rates, latencies, and success rates</li>
            </ul>
            
            <h4 style="color: #d32f2f; margin-top: 20px;">‚ùå What the Pre-hydrator is NOT Responsible For:</h4>
            <ul style="line-height: 1.8; color: #2c3e50;">
                <li><strong>Authentication:</strong> Does NOT authenticate users - relies on existing session token from cookie</li>
                <li><strong>Data Serving:</strong> Does NOT serve data to applications - apps read from Redis directly</li>
                <li><strong>Session Creation:</strong> Does NOT create or manage sessions - only uses existing ones</li>
                <li><strong>Business Logic:</strong> Does NOT implement app-specific logic - only fetches and caches</li>
                <li><strong>Cache Reads:</strong> Does NOT intercept or proxy cache reads from applications</li>
            </ul>
            
            <h4 style="color: #1976d2; margin-top: 20px;">üéØ Critical Design Decision: Direct Redis Access</h4>
            <div style="background: white; padding: 15px; border-radius: 6px; margin-top: 10px;">
                <p style="margin: 0 0 10px 0;"><strong>Q: Do applications read from Redis directly or go through the pre-hydrator?</strong></p>
                <p style="margin: 0; color: #27ae60; font-weight: bold;">A: Applications read from Redis DIRECTLY. Here's why:</p>
                <ol style="line-height: 1.8; color: #2c3e50; margin-top: 10px;">
                    <li><strong>Performance:</strong> Direct Redis reads are fastest (~1-5ms). Adding another service layer adds latency.</li>
                    <li><strong>Scalability:</strong> Redis can handle millions of reads/sec. No bottleneck from pre-hydrator service.</li>
                    <li><strong>Simplicity:</strong> Applications use standard Redis client libraries - no custom integration needed.</li>
                    <li><strong>Reliability:</strong> No single point of failure. If pre-hydrator is down, apps still work (cache miss ‚Üí fallback to backend).</li>
                    <li><strong>Separation of Concerns:</strong> Pre-hydrator is WRITE-ONLY for proactive caching. Apps are READ-ONLY consumers.</li>
                </ol>
            </div>
            
            <h4 style="color: #1976d2; margin-top: 20px;">üìã Typical Application Code Pattern:</h4>
            <div style="background: #263238; padding: 15px; border-radius: 6px; margin-top: 10px; color: #aed581; font-family: monospace; font-size: 13px; overflow-x: auto;">
<pre style="margin: 0; color: #aed581;">// Application Team's Service Layer Code
async getUserProfile(userId) {
    // 1. Try cache FIRST (populated by pre-hydrator)
    const cached = await redis.get(`user:profile:${userId}`);
    if (cached) {
        return JSON.parse(cached);  // ‚ö° ~5ms
    }
    
    // 2. Cache miss - fallback to backend service
    const profile = await profileService.get(userId);  // ~500ms
    
    // 3. Store in cache for next time
    await redis.setex(`user:profile:${userId}`, 3600, JSON.stringify(profile));
    
    return profile;
}</pre>
            </div>
            
            <p style="margin-top: 15px; color: #2c3e50; line-height: 1.8;">
                <strong>The pre-hydrator's job is to ensure that step #1 (cache check) returns a HIT instead of proceeding to step #2 (slow backend call).</strong>
            </p>
        </div>
        
        <!-- Important Notes -->
        <div style="margin-top: 20px; padding: 25px; background: #fff3e0; border-left: 5px solid #ff9800; border-radius: 8px;">
            <h3 style="margin-top: 0; color: #f57c00;">Important Considerations</h3>
            <ul style="line-height: 1.8; color: #2c3e50;">
                <li><strong>Security:</strong> Validate and encrypt session tokens; rotate regularly</li>
                <li><strong>Privacy:</strong> Clear cached data on logout; comply with data retention policies</li>
                <li><strong>Graceful Degradation:</strong> App must work even if pre-hydration fails</li>
                <li><strong>Timeout Strategy:</strong> Use aggressive timeouts (3-5s) for pre-hydration calls</li>
                <li><strong>Monitoring:</strong> Track cache hit rates, pre-hydration success rates, and latencies</li>
            </ul>
        </div>
    </div>
</body>
</html>
